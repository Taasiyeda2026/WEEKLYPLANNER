<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>יומן פעילות</title>

<meta name="theme-color" content="#4f46e5">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" sizes="180x180" href="icon-192.png">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#f3f4f8;
  --card:#ffffff;
  --border:#e6e8ef;
  --primary:#5b4ce2;
  --text:#1f2937;
  --muted:#6b7280;
}

*{box-sizing:border-box}
body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text)}

header{
  background:#fff;
  padding:24px 16px;
  text-align:center;
  border-bottom:1px solid var(--border);
}

header img{height:48px;margin-bottom:8px}

h1{margin:0;font-size:22px;font-weight:700}

.login-wrapper{
  min-height:80vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.login-card{
  width:100%;
  max-width:320px;
  background:var(--card);
  padding:36px 28px;
  border-radius:22px;
  border:1px solid var(--border);
  box-shadow:0 25px 60px rgba(0,0,0,0.05);
}

.login-box{display:flex;flex-direction:column;gap:16px}

.login-box input{
  height:64px;
  border-radius:16px;
  border:1px solid var(--border);
  text-align:center;
  font-size:16px;
  font-weight:600;
  background:#fafbff;
}

.login-box button{
  height:36px;
  width:120px;
  align-self:center;
  border-radius:999px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:600;
  font-size:13px;
  cursor:pointer;
}

.greeting{
  text-align:center;
  font-weight:600;
  padding:18px;
}

.week-nav{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:18px;
  padding:14px;
}

.nav-btn{
  width:36px;
  height:36px;
  border-radius:50%;
  border:1px solid var(--border);
  background:#fff;
  cursor:pointer;
}

.week-title{
  font-weight:600;
}

.calendar{
  padding:20px;
  max-width:1200px;
  margin:auto;
}

.calendar-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:16px;
}

.day{
  background:var(--card);
  border-radius:20px;
  border:1px solid var(--border);
  min-height:140px;
  padding:14px;
  position:relative;
  cursor:pointer;
  transition:0.2s;
}

.day:hover{box-shadow:0 10px 25px rgba(0,0,0,0.05)}

.day-header{
  font-size:13px;
  font-weight:600;
  color:var(--muted);
  margin-bottom:8px;
}

.day-number{
  font-weight:700;
  font-size:15px;
}

.today{
  border:2px solid var(--primary);
}

.activity{
  font-size:12px;
  margin-top:6px;
  padding:6px 8px;
  border-radius:12px;
  background:#f1f5ff;
}

.popup-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.35);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.popup{
  background:#fff;
  padding:26px;
  border-radius:22px;
  width:92%;
  max-width:420px;
  box-shadow:0 25px 60px rgba(0,0,0,0.2);
}

@media(max-width:900px){
  .calendar-grid{grid-template-columns:repeat(2,1fr)}
}

@media(max-width:600px){
  .calendar-grid{grid-template-columns:1fr}
}

</style>
</head>
<body>

<header>
  <img src="logo.png" alt="Logo">
  <h1>יומן פעילות</h1>
</header>

<div class="login-wrapper" id="loginSection">
  <div class="login-card">
    <div class="login-box">
      <input id="empID" type="password" placeholder="מספר עובד" inputmode="numeric" autocomplete="off">
      <input id="code" type="password" placeholder="קוד אישי" inputmode="numeric" autocomplete="off">
      <button onclick="login()">כניסה</button>
    </div>
  </div>
</div>

<div id="appSection" style="display:none;">
  <div class="greeting" id="greeting"></div>
  <div class="week-nav">
    <button class="nav-btn" onclick="prevWeek()">›</button>
    <div class="week-title" id="weekTitle"></div>
    <button class="nav-btn" onclick="nextWeek()">‹</button>
  </div>
  <div class="calendar">
    <div id="weekView" class="calendar-grid"></div>
  </div>
</div>

<div class="popup-overlay" id="popupOverlay" onclick="closePopup(event)">
  <div class="popup" id="popupContent"></div>
</div>

<script>

const EXCEL_FILE = "InstructorData.xlsx";

// ===== Program Fixed Colors =====
const programColors = {
  "Biomimicry - Middle School": "#F0FFFF",
  "Green Leadership": "#FFFDD0",
  "Space Technologies": "#E2F9E1",
  "Biomimicry": "#F0F5F1",
  "Artificial Intelligence": "#FDF2F2",
  "Rokechim Olam": "#F0F8FF",
  "Sky Is Not The Limit": "#F5F5F5",
  "Porotzot Derech": "#FFF0F5",
  "AI Applications": "#FFF5EE",
  "Premium": "#FEF9E7"
};
let rawData = [];
let currentEmployeeName = "";
let currentWeekStart = getStartOfWeek(new Date());

function getStartOfWeek(date){
  const d = new Date(date);
  const day = d.getDay();
  const diff = d.getDate() - day;
  d.setDate(diff);
  d.setHours(0,0,0,0);
  return d;
}

async function login(){
  const empNumber = document.getElementById('empID').value;
  await loadExcel();

  const employeeRows = rawData.filter(r => String(r["EmployeeID"]) === empNumber);
  if(employeeRows.length === 0){
    alert("מספר עובד לא נמצא");
    return;
  }

  currentEmployeeName = employeeRows[0]["EmployeeName"];
  document.getElementById('greeting').innerText = "שלום " + currentEmployeeName;
  document.getElementById('loginSection').style.display='none';
  document.getElementById('appSection').style.display='block';
  renderWeek();
}

async function loadExcel(){
  const res = await fetch(EXCEL_FILE + "?t=" + Date.now());
  const data = await res.arrayBuffer();
  const workbook = XLSX.read(data, { type: "array" });
  const sheet = workbook.Sheets[workbook.SheetNames[0]];
  rawData = XLSX.utils.sheet_to_json(sheet);
}

function renderWeek(){
  const container = document.getElementById('weekView');
  const title = document.getElementById('weekTitle');
  container.innerHTML='';

  const start = new Date(currentWeekStart);
  const end = new Date(start);
  end.setDate(start.getDate()+6);
  title.innerText = start.toLocaleDateString('he-IL') + " - " + end.toLocaleDateString('he-IL');

  const today = new Date();

  for(let i=0;i<7;i++){
    const dayDate = new Date(start);
    dayDate.setDate(start.getDate()+i);

    const div = document.createElement('div');
    div.className='day';
    if(dayDate.toDateString()===today.toDateString()) div.classList.add('today');

    div.innerHTML = `
      <div class="day-header">${dayDate.toLocaleDateString('he-IL',{weekday:'long'})}</div>
      <div class="day-number">${dayDate.getDate()}</div>
    `;

    const activities = rawData.filter(r => 
      r["EmployeeName"] === currentEmployeeName &&
      new Date(r["Date"]).toDateString() === dayDate.toDateString()
    );

    activities.forEach(act=>{
      const item = document.createElement('div');
      item.className='activity';
      const color = programColors[act["Program"]] || '#f1f5ff';
      item.style.background = color;
      item.innerText = act["Program"] + " " + act["StartTime"] + "-" + act["EndTime"];
      div.appendChild(item);
    });

    div.onclick = ()=>openPopup(dayDate, activities);
    container.appendChild(div);
  }
}

function openPopup(date, activities){
  const overlay = document.getElementById('popupOverlay');
  const content = document.getElementById('popupContent');

  let html = `<h3>${date.toLocaleDateString('he-IL')}</h3>`;
  if(activities.length === 0){
    html += "<p>אין פעילות מתוכננת</p>";
  } else {
    activities.forEach(act=>{
      html += `<p><strong>${act["Program"]}</strong><br>${act["StartTime"]} - ${act["EndTime"]}</p>`;
    });
  }

  content.innerHTML = html;
  overlay.style.display='flex';
}

function closePopup(e){
  if(e.target.id==='popupOverlay'){
    document.getElementById('popupOverlay').style.display='none';
  }
}

function prevWeek(){currentWeekStart.setDate(currentWeekStart.getDate()-7);renderWeek();}
function nextWeek(){currentWeekStart.setDate(currentWeekStart.getDate()+7);renderWeek();}

if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js');
  });
}

</script>

</body>
</html>
